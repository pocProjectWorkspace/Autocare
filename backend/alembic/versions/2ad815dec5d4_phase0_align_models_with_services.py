"""phase0_align_models_with_services

Revision ID: 2ad815dec5d4
Revises: 
Create Date: 2026-02-07 17:03:49.163026
"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import sqlite
from app.core.database import GUID

revision = '2ad815dec5d4'
down_revision = None
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('diagnoses', sa.Column('findings', sa.Text(), nullable=True))
    op.add_column('diagnoses', sa.Column('severity', sa.String(length=20), nullable=True))
    op.add_column('diagnoses', sa.Column('diagnostic_photos', sa.JSON(), nullable=True))
    op.add_column('diagnoses', sa.Column('diagnostic_videos', sa.JSON(), nullable=True))
    op.add_column('diagnoses', sa.Column('requires_parts', sa.Boolean(), nullable=True))
    op.add_column('diagnoses', sa.Column('estimated_labour_hours', sa.Float(), nullable=True))
    op.add_column('diagnoses', sa.Column('estimated_completion_days', sa.Integer(), nullable=True))
    op.add_column('diagnoses', sa.Column('diagnosed_at', sa.DateTime(), nullable=True))
    op.drop_column('diagnoses', 'technical_report')
    op.add_column('invoices', sa.Column('invoice_type', sa.String(length=50), nullable=True))
    op.add_column('invoices', sa.Column('line_items', sa.JSON(), nullable=True))
    op.add_column('invoices', sa.Column('tax_rate', sa.Float(), nullable=True))
    op.add_column('invoices', sa.Column('total_amount', sa.Float(), nullable=True))
    op.add_column('invoices', sa.Column('terms', sa.Text(), nullable=True))
    op.add_column('invoices', sa.Column('due_date', sa.DateTime(), nullable=True))
    op.add_column('invoices', sa.Column('is_paid', sa.Boolean(), nullable=True))
    op.add_column('job_cards', sa.Column('pickup_driver_id', GUID(), nullable=True))
    op.add_column('job_cards', sa.Column('delivery_driver_id', GUID(), nullable=True))
    op.add_column('job_cards', sa.Column('vehicle_picked_at', sa.DateTime(), nullable=True))
    op.add_column('job_cards', sa.Column('delivered_at', sa.DateTime(), nullable=True))
    op.add_column('job_cards', sa.Column('driver_latitude', sa.Float(), nullable=True))
    op.add_column('job_cards', sa.Column('driver_longitude', sa.Float(), nullable=True))
    op.add_column('job_cards', sa.Column('location_updated_at', sa.DateTime(), nullable=True))
    op.create_foreign_key(None, 'job_cards', 'users', ['pickup_driver_id'], ['id'])
    op.create_foreign_key(None, 'job_cards', 'users', ['delivery_driver_id'], ['id'])
    op.add_column('notifications', sa.Column('is_sent', sa.Boolean(), nullable=True))
    op.add_column('notifications', sa.Column('sent_at', sa.DateTime(), nullable=True))
    op.alter_column('notifications', 'notification_type',
               existing_type=sa.VARCHAR(length=16),
               type_=sa.Enum('INFO', 'SUCCESS', 'WARNING', 'ERROR', 'JOB_STATUS', 'STATUS_UPDATE', 'ESTIMATE_READY', 'PARTS_QUOTE_READY', 'PAYMENT_REQUEST', 'PAYMENT_RECEIVED', 'RFQ_RECEIVED', name='notificationtype'),
               existing_nullable=True)
    op.add_column('payments', sa.Column('payment_number', sa.String(length=50), nullable=True))
    op.add_column('payments', sa.Column('collected_by_id', GUID(), nullable=True))
    op.add_column('payments', sa.Column('payment_method', sa.Enum('CASH', 'CARD', 'ONLINE', 'BANK_TRANSFER', 'CHEQUE', 'PAYMENT_LINK', name='paymentmethod'), nullable=True))
    op.add_column('payments', sa.Column('gateway_transaction_id', sa.String(length=255), nullable=True))
    op.add_column('payments', sa.Column('gateway_response', sa.JSON(), nullable=True))
    op.add_column('payments', sa.Column('payment_link_url', sa.String(length=500), nullable=True))
    op.add_column('payments', sa.Column('payment_link_expires', sa.DateTime(), nullable=True))
    op.alter_column('payments', 'user_id',
               existing_type=sa.CHAR(length=36),
               nullable=True)
    op.create_index(op.f('ix_payments_payment_number'), 'payments', ['payment_number'], unique=True)
    op.create_foreign_key(None, 'payments', 'users', ['collected_by_id'], ['id'])
    op.drop_column('payments', 'method')
    op.drop_column('payments', 'payment_link')
    op.add_column('rfqs', sa.Column('rfq_number', sa.String(length=50), nullable=True))
    op.add_column('rfqs', sa.Column('parts_list', sa.JSON(), nullable=True))
    op.add_column('rfqs', sa.Column('quote_deadline', sa.DateTime(), nullable=True))
    op.add_column('rfqs', sa.Column('selection_rule', sa.String(length=50), nullable=True))
    op.add_column('rfqs', sa.Column('max_delivery_days', sa.Integer(), nullable=True))
    op.add_column('rfqs', sa.Column('sent_at', sa.DateTime(), nullable=True))
    op.add_column('rfqs', sa.Column('selected_quote_id', GUID(), nullable=True))
    op.add_column('rfqs', sa.Column('selected_at', sa.DateTime(), nullable=True))
    op.add_column('rfqs', sa.Column('selected_by_id', GUID(), nullable=True))
    op.add_column('rfqs', sa.Column('selection_reason', sa.Text(), nullable=True))
    op.create_index(op.f('ix_rfqs_rfq_number'), 'rfqs', ['rfq_number'], unique=True)
    op.create_foreign_key(None, 'rfqs', 'vendor_quotes', ['selected_quote_id'], ['id'])
    op.create_foreign_key(None, 'rfqs', 'users', ['selected_by_id'], ['id'])
    op.drop_column('rfqs', 'expires_at')
    op.drop_column('rfqs', 'items')
    op.add_column('vehicle_intakes', sa.Column('performed_by_id', GUID(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('odometer_reading', sa.Integer(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('toolkit', sa.Boolean(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('floor_mats', sa.Boolean(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('first_aid_kit', sa.Boolean(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('fire_extinguisher', sa.Boolean(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('exterior_damages', sa.JSON(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('exterior_photos', sa.JSON(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('exterior_notes', sa.Text(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('interior_photos', sa.JSON(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('interior_condition', sa.JSON(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('interior_notes', sa.Text(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('items_in_vehicle', sa.JSON(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('items_photos', sa.JSON(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('customer_acknowledged', sa.Boolean(), nullable=True))
    op.drop_constraint(None, 'vehicle_intakes', type_='foreignkey')
    op.create_foreign_key(None, 'vehicle_intakes', 'users', ['performed_by_id'], ['id'])
    op.drop_column('vehicle_intakes', 'advisor_id')
    op.drop_column('vehicle_intakes', 'mileage')
    op.drop_column('vehicle_intakes', 'exterior_damage')
    op.add_column('vendor_quotes', sa.Column('quote_number', sa.String(length=50), nullable=True))
    op.add_column('vendor_quotes', sa.Column('line_items', sa.JSON(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('subtotal', sa.Float(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('tax_amount', sa.Float(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('delivery_notes', sa.Text(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('warranty_months', sa.Integer(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('warranty_terms', sa.String(length=500), nullable=True))
    op.add_column('vendor_quotes', sa.Column('valid_until', sa.DateTime(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('vendor_notes', sa.Text(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('submitted_at', sa.DateTime(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('updated_at', sa.DateTime(), nullable=True))
    op.create_index(op.f('ix_vendor_quotes_quote_number'), 'vendor_quotes', ['quote_number'], unique=True)
    op.drop_column('vendor_quotes', 'quote_data')
    op.drop_column('vendor_quotes', 'notes')
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('vendor_quotes', sa.Column('notes', sa.TEXT(), nullable=True))
    op.add_column('vendor_quotes', sa.Column('quote_data', sqlite.JSON(), nullable=True))
    op.drop_index(op.f('ix_vendor_quotes_quote_number'), table_name='vendor_quotes')
    op.drop_column('vendor_quotes', 'updated_at')
    op.drop_column('vendor_quotes', 'submitted_at')
    op.drop_column('vendor_quotes', 'vendor_notes')
    op.drop_column('vendor_quotes', 'valid_until')
    op.drop_column('vendor_quotes', 'warranty_terms')
    op.drop_column('vendor_quotes', 'warranty_months')
    op.drop_column('vendor_quotes', 'delivery_notes')
    op.drop_column('vendor_quotes', 'tax_amount')
    op.drop_column('vendor_quotes', 'subtotal')
    op.drop_column('vendor_quotes', 'line_items')
    op.drop_column('vendor_quotes', 'quote_number')
    op.add_column('vehicle_intakes', sa.Column('exterior_damage', sqlite.JSON(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('mileage', sa.INTEGER(), nullable=True))
    op.add_column('vehicle_intakes', sa.Column('advisor_id', sa.CHAR(length=36), nullable=False))
    op.drop_constraint(None, 'vehicle_intakes', type_='foreignkey')
    op.create_foreign_key(None, 'vehicle_intakes', 'users', ['advisor_id'], ['id'])
    op.drop_column('vehicle_intakes', 'customer_acknowledged')
    op.drop_column('vehicle_intakes', 'items_photos')
    op.drop_column('vehicle_intakes', 'items_in_vehicle')
    op.drop_column('vehicle_intakes', 'interior_notes')
    op.drop_column('vehicle_intakes', 'interior_condition')
    op.drop_column('vehicle_intakes', 'interior_photos')
    op.drop_column('vehicle_intakes', 'exterior_notes')
    op.drop_column('vehicle_intakes', 'exterior_photos')
    op.drop_column('vehicle_intakes', 'exterior_damages')
    op.drop_column('vehicle_intakes', 'fire_extinguisher')
    op.drop_column('vehicle_intakes', 'first_aid_kit')
    op.drop_column('vehicle_intakes', 'floor_mats')
    op.drop_column('vehicle_intakes', 'toolkit')
    op.drop_column('vehicle_intakes', 'odometer_reading')
    op.drop_column('vehicle_intakes', 'performed_by_id')
    op.add_column('rfqs', sa.Column('items', sqlite.JSON(), nullable=False))
    op.add_column('rfqs', sa.Column('expires_at', sa.DATETIME(), nullable=True))
    op.drop_constraint(None, 'rfqs', type_='foreignkey')
    op.drop_constraint(None, 'rfqs', type_='foreignkey')
    op.drop_index(op.f('ix_rfqs_rfq_number'), table_name='rfqs')
    op.drop_column('rfqs', 'selection_reason')
    op.drop_column('rfqs', 'selected_by_id')
    op.drop_column('rfqs', 'selected_at')
    op.drop_column('rfqs', 'selected_quote_id')
    op.drop_column('rfqs', 'sent_at')
    op.drop_column('rfqs', 'max_delivery_days')
    op.drop_column('rfqs', 'selection_rule')
    op.drop_column('rfqs', 'quote_deadline')
    op.drop_column('rfqs', 'parts_list')
    op.drop_column('rfqs', 'rfq_number')
    op.add_column('payments', sa.Column('payment_link', sa.VARCHAR(length=500), nullable=True))
    op.add_column('payments', sa.Column('method', sa.VARCHAR(length=13), nullable=True))
    op.drop_constraint(None, 'payments', type_='foreignkey')
    op.drop_index(op.f('ix_payments_payment_number'), table_name='payments')
    op.alter_column('payments', 'user_id',
               existing_type=sa.CHAR(length=36),
               nullable=False)
    op.drop_column('payments', 'payment_link_expires')
    op.drop_column('payments', 'payment_link_url')
    op.drop_column('payments', 'gateway_response')
    op.drop_column('payments', 'gateway_transaction_id')
    op.drop_column('payments', 'payment_method')
    op.drop_column('payments', 'collected_by_id')
    op.drop_column('payments', 'payment_number')
    op.alter_column('notifications', 'notification_type',
               existing_type=sa.Enum('INFO', 'SUCCESS', 'WARNING', 'ERROR', 'JOB_STATUS', 'STATUS_UPDATE', 'ESTIMATE_READY', 'PARTS_QUOTE_READY', 'PAYMENT_REQUEST', 'PAYMENT_RECEIVED', 'RFQ_RECEIVED', name='notificationtype'),
               type_=sa.VARCHAR(length=16),
               existing_nullable=True)
    op.drop_column('notifications', 'sent_at')
    op.drop_column('notifications', 'is_sent')
    op.drop_constraint(None, 'job_cards', type_='foreignkey')
    op.drop_constraint(None, 'job_cards', type_='foreignkey')
    op.drop_column('job_cards', 'location_updated_at')
    op.drop_column('job_cards', 'driver_longitude')
    op.drop_column('job_cards', 'driver_latitude')
    op.drop_column('job_cards', 'delivered_at')
    op.drop_column('job_cards', 'vehicle_picked_at')
    op.drop_column('job_cards', 'delivery_driver_id')
    op.drop_column('job_cards', 'pickup_driver_id')
    op.drop_column('invoices', 'is_paid')
    op.drop_column('invoices', 'due_date')
    op.drop_column('invoices', 'terms')
    op.drop_column('invoices', 'total_amount')
    op.drop_column('invoices', 'tax_rate')
    op.drop_column('invoices', 'line_items')
    op.drop_column('invoices', 'invoice_type')
    op.add_column('diagnoses', sa.Column('technical_report', sa.TEXT(), nullable=False))
    op.drop_column('diagnoses', 'diagnosed_at')
    op.drop_column('diagnoses', 'estimated_completion_days')
    op.drop_column('diagnoses', 'estimated_labour_hours')
    op.drop_column('diagnoses', 'requires_parts')
    op.drop_column('diagnoses', 'diagnostic_videos')
    op.drop_column('diagnoses', 'diagnostic_photos')
    op.drop_column('diagnoses', 'severity')
    op.drop_column('diagnoses', 'findings')
    # ### end Alembic commands ###
